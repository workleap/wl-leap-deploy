# Microservices Example
# =====================
# A collection of interconnected microservices forming a complete application.
# Includes API gateway, multiple backend services, and background workers.

id: ecommerce-platform

workloads:
  # API Gateway - entry point for all requests
  api-gateway:
    type: api

    image:
      repository: ecommerce/api-gateway

    ingress:
      pathPrefix: /
      fqdn: api.ecommerce.example.com

    replicas: 3

    resources:
      requests:
        cpu: 200m
        memory: 256Mi

    autoscaling:
      horizontal:
        minReplicas: 3
        maxReplicas: 15

    annotations:
      apps.workleap.com/flavor: gateway

  # User Service - handles authentication and user management
  user-service:
    type: api

    image:
      repository: ecommerce/user-service

    ingress:
      pathPrefix: /users

    replicas: 2

    resources:
      requests:
        cpu: 100m
        memory: 128Mi

    environments:
      prod:
        replicas: 4
        autoscaling:
          horizontal:
            minReplicas: 4
            maxReplicas: 10

  # Product Catalog - manages product inventory
  product-catalog:
    type: api

    image:
      repository: ecommerce/product-catalog

    ingress:
      pathPrefix: /products

    replicas: 2

    resources:
      requests:
        cpu: 150m
        memory: 192Mi

    environments:
      prod:
        replicas: 5
        resources:
          requests:
            cpu: 300m
            memory: 384Mi

  # Order Service - processes customer orders
  order-service:
    type: api

    image:
      repository: ecommerce/order-service

    ingress:
      pathPrefix: /orders

    replicas: 2

    resources:
      requests:
        cpu: 200m
        memory: 256Mi

    environments:
      prod:
        replicas: 6
        autoscaling:
          horizontal:
            minReplicas: 6
            maxReplicas: 20

  # Payment Processor Worker - handles payment processing async
  payment-worker:
    type: worker

    image:
      repository: ecommerce/payment-processor

    ingress: null

    replicas: 2

    resources:
      requests:
        cpu: 300m
        memory: 384Mi

    annotations:
      apps.workleap.com/flavor: worker
      security.workleap.com/pci-dss: "true"

    environments:
      prod:
        replicas: 4
        resources:
          requests:
            cpu: 500m
            memory: 512Mi

  # Notification Worker - sends emails, SMS, push notifications
  notification-worker:
    type: worker

    image:
      repository: ecommerce/notification-service

    ingress: null

    replicas: 1

    resources:
      requests:
        cpu: 100m
        memory: 128Mi

    annotations:
      apps.workleap.com/flavor: worker

    environments:
      prod:
        replicas: 3
        autoscaling:
          horizontal:
            minReplicas: 3
            maxReplicas: 8
